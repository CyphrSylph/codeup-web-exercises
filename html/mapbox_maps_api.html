<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Mapbox Map</title>
	<!-- MAPBOX CSS -->
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
	<!-- CUSTOM CSS -->
	<style>
        #map {
            /* SET WIDTH OR HEIGHT TO ANY SIZE */
            width: 100%;
            height: 500px;
        }
	</style>
</head>
<body>
	<!-- MAPBOX HEADER-->
	<h1>Mapbox Map</h1>
	<!-- MAPBOX CONTAINER -->
	<div id='map'></div>
	<!-- ZOOM BUTTON -->
	<button id="zoom-in">Zoom</button>
	<!-- PIN BUTTON -->
	<button id="pin-marker">Pin Location</button>

	<!-- MAPBOX JS -->
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>

	<!-- CUSTOM JS -->
	<!-- LINK TO MAPBOX KEY-->
	<script src='../js/keys.js'></script>
	<script>
	(async function() {
		// DISPLAY MAPBOX API VIA TOKEN KEY
		mapboxgl.accessToken = mapboxAPIkey;
		let map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/streets-v9',
			zoom: 10,
			center: [-98.4916, 29.4252]
		});
		// FETCHING LOCATION WITH GEOCODE FUNCTION
		function latLangAddy(addy, token = mapboxAPIkey) {
			const url = 'https://api.mapbox.com/geocoding/v5/mapbox.places/';
			return fetch(`${url}${encodeURIComponent(addy)}.json?access_token=${token}`)
				.then(async function(res) {
					const data = await res.json();
					return data.features[0].center;
				});
		}
		// INCREASE ZOOM LEVEL WHEN BUTTON IS CLICKED
		const zoomIn = document.querySelector('#zoom-in');
		zoomIn.addEventListener('click', function(e) {
			let currentZoom = map.getZoom();
			currentZoom++;
			map.setZoom(currentZoom);
		});
		// ADD EVENT LISTENER TO DROP PIN BUTTON
		document.querySelector("#pin-marker").addEventListener("click", function (E) {
			// RUN DROP PIN FUNCTION WITH NEW ADDRESS AND INFO
			dropPin('4051 Broadway St. San Antonio, TX 78209','Koi Kawa');
			dropPin('123 Losoya St. San Antonio, TX 78205','Makenka Hot Truck');
			dropPin('1705 Blanco Rd, San Antonio, TX 78212','Bright Coffee');
		});

		async function dropPin(addy,pinInfo) {
			// SET NEW PIN LOCATION WITH GEOCODE FUNCTION
			let pinLocation = await latLangAddy(addy)
			let pin = new mapboxgl.Marker();
			let popup = new mapboxgl.Popup();
			pin.setLngLat(pinLocation);
			pin.setPopup(popup);
			pin.addTo(map);
			// ADD POPUP TO PIN
			popup.setLngLat(pinLocation);
			popup.setHTML('<p>'+ pinInfo +'</p>');
		}
	})();

</script>
</body>
</html>






